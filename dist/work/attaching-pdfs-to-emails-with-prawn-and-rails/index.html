

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- charset/http-equiv/viewport -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- title -->
    <title>
      
      Attaching PDFs to emails with Prawn and Rails
      
    </title>
    <!-- synchronous js / schema  -->
    <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://chadfield.org#website",
        "url": "https://chadfield.org",
        "name": "Problem First",
        "description": "Problem First is a blog by Ben Chadfield about Product Management, Leadership, Technology, and Life.",
        "inLanguage": "en_EN"
      }
    ]
  }
</script>
 
    <!-- include blogpost schema  --><script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
      "@type": "WebPage"
    },
    "isPartOf": {
      "@id": "https://chadfield.org#website"
    },
    "@id": "",
    "headline": "Attaching PDFs to emails with Prawn and Rails",
    "description": "Problem First is a blog by Ben Chadfield about Product Management, Leadership, Technology, and Life.",
    "image": "https://chadfield.org/assets/images/opengraph-default.jpg",
    "inLanguage": "en_EN",
    "publisher": {
      "@type": "Person",
      "name": "Ben Chadfield",
      "url": "https://chadfield.org"
    },
    "author": {
      "@type": "Person",
      "name": "Ben Chadfield"
    },
    "datePublished": "2013-03-31T00:00:00.000Z"
  }
</script>
 

    <!-- synchronous css / inline css  -->
    <link rel="stylesheet" href="/assets/css/global.css?1b8f-aa75-e037" />

    <!-- preloads -->
    <link
      rel="preload"
      href="/assets/fonts/inter/inter-v7-latin-500.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/assets/fonts/inter/inter-v7-latin-700.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/assets/fonts/redhat/red-hat-display-v7-latin-900.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <!-- preloads in page data -->
    <!-- prettier-ignore -->
    <link rel="preload"
            href="/assets/fonts/robotomono/robotomono-variablefont_wght-webfont.woff2"
            as="font"
            type=font/woff2
            crossorigin />
    

    <!-- defered js  -->
    <script type="module" src="/assets/scripts/app.js?1b8f-aa75-e037" defer></script>

    <!-- everything else: meta tags, icons, open graph etc.  -->
    <base href="/work/attaching-pdfs-to-emails-with-prawn-and-rails/" />

<meta
  name="description"
  content="
  
  Problem First is a blog by Ben Chadfield about Product Management, Leadership, Technology, and Life.
  
  "
/>

<meta name="theme-color" content="#DD4462" />
<meta name="robots" content="index,follow" /><!-- All Search Engines -->
<meta name="googlebot" content="index,follow" /><!-- Google Specific -->
<meta name="generator" content="Eleventy v2.0.0" /><!-- thank you, Zach -->
<!-- Disable automatic detection and formatting of possible phone numbers -->
<meta name="format-detection" content="telephone=no" />
<!-- Helps prevent duplicate content issues -->
<link rel="canonical" href="https://chadfield.org/work/attaching-pdfs-to-emails-with-prawn-and-rails/" />

<!-- Links to information about the author(s) of the document -->
<link rel="author" href="humans.txt" />



<!-- Open Graph meta  -->
<meta property="og:url" content="https://chadfield.org/work/attaching-pdfs-to-emails-with-prawn-and-rails/" />
<meta property="og:type" content="website" />
<meta
  property="og:title"
  content="Attaching PDFs to emails with Prawn and Rails"
/>
<meta
  property="og:image"
  content="https://chadfield.org/assets/images/opengraph-default.jpg"
/>
<meta
  property="og:description"
  content="Problem First is a blog by Ben Chadfield about Product Management, Leadership, Technology, and Life."
/>
<meta property="og:site_name" content="Problem First" />
<meta property="og:locale" content="en_EN" />
<meta property="article:author" content="Ben Chadfield" />

<!-- Twitter meta -->
<meta name="twitter:card" content="summary_large_image" />
 
<meta name="twitter:dnt" content="on" />

<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🛸</text></svg>">

    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-37077125-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-37077125-1');
    </script>


  </head>

  <body class="relative">
    <!-- header -->
    <a href="#main" class="skip-link">Skip to content</a>

<header class="relative" role="banner">
  <div class="site-head | ontop spot-color-primary">
    <div class="site-head-left">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        aria-hidden="true"
        focusable="false"
        id="theme-toggle"
      >
        <path
          fill-rule="evenodd"
          d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z"
          clip-rule="evenodd"
        />
      </svg>

      
      <a href="/" class="logo site-head__brand | no-underline" >
        Problem First
      </a>
    </div>

    <nav id="mainnav" class="navbar" aria-label="Main">
  <ul>
    
    <li>
      <a
        class="nav"
        href="/"
        
        >Blog</a
      >
    </li>
    
    <li>
      <a
        class="nav"
        href="/descendants/"
        
        >Descendants</a
      >
    </li>
    
    <li>
      <a
        class="nav"
        href="/about/"
        
        >Ben Chadfield</a
      >
    </li>
    
    <li><img class="avatar" src="/assets/images/bc-face.jpg" /></li>
  </ul>
</nav>

<!--  template element holding a button that needs to be injected when JavaScript is finally available. based on an article by Manuel Matuzovic, https://web.dev/website-navigation/, see also https://kittygiraudel.com/2022/09/30/templating-in-html/ -->

<template id="burger-template">
  <button type="button" aria-expanded="false" aria-label="Menu" aria-controls="mainnav">
    <span>Menu</span>
    <svg width="24" height="24" aria-hidden="true">
      <path
        fill-rule="evenodd"
        d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z"
        clip-rule="evenodd"
      />
    </svg>
  </button>
</template>

  </div>
</header>


    <!-- content slot -->
    <main id="main" class="relative">
<article class="region blog">
  <div class="wrapper flow prose">
    <div class="post-header">
      <img src="/assets/images/posts/attaching-pdfs-rails-prawn.png" />
      <h1>Attaching PDFs to emails with Prawn and Rails</h1>
    </div>

     <time datetime="2013-03-31T00:00:00.000Z">
  March 31, 2013
</time>


    <p>Yesterday I released a very simple tool to help copywriters get better briefs. I had a couple of days dev time up my sleeve while other parts of the main <a href="http://csworkflow.com" target="_blank">CS Workflow</a> project are getting worked on.</p>
<p>What I ended up with was a simple signup for copywriters. This generates a token that, when part of a URL, associates the brief with the copywriter. The briefs are a tableless model and are only saved as an attached PDF that is sent to the copywriter. Simple.</p>
<p>I decided to use Prawn over the other options after watching the <a href="http://railscasts.com/episodes/153-pdfs-with-prawn-revised" target="_blank">railscast</a> (requires pro subscription) on the topic. It gave me the most control over the rendered PDF. For this project I used Rail 4.0.0.beta1.</p>
<p>To start I added Prawn to my Gemfile and ran bundle. The latest version was 0.12.0 at writing.</p>
<pre class="language-ruby"><code class="language-ruby">gem <span class="token string-literal"><span class="token string">'prawn'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'~> 0.12.0'</span></span></code></pre>
<p>I found out that through an error message that Rails 4 already has the PDF mimetype registered, so that part of the railscast can be skipped.</p>
<p>I rendered a test PDF in the browser so I could make sure it looked how I wanted before attaching it to an email. Refreshing the browser displayed the changes. To get this working I created a ‘test’ action in my briefs controller and added that as a route.</p>
<pre class="language-elixir"><code class="language-elixir"><span class="token keyword">def</span> test<br>  <span class="token attribute variable">@brief</span> <span class="token operator">=</span> <span class="token module class-name">Brief</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>test_brief<span class="token punctuation">)</span><br>  <span class="token attribute variable">@user</span> <span class="token operator">=</span> <span class="token module class-name">User</span><span class="token punctuation">.</span><span class="token function">find_by_email</span><span class="token punctuation">(</span><span class="token string">"ben@csworkflow.com"</span><span class="token punctuation">)</span><br>  respond_to <span class="token keyword">do</span> <span class="token operator">|</span>format<span class="token operator">|</span><br>    format<span class="token punctuation">.</span>pdf <span class="token keyword">do</span><br>      pdf <span class="token operator">=</span> <span class="token module class-name">BriefPdf</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token attribute variable">@brief</span><span class="token punctuation">,</span> <span class="token attribute variable">@user</span><span class="token punctuation">)</span><br>      send_data pdf<span class="token punctuation">.</span>render<span class="token punctuation">,</span> <span class="token attr-name">filename:</span> <span class="token string">"brief_<span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token attribute variable">@brief</span><span class="token punctuation">.</span>name<span class="token delimiter punctuation">}</span></span>"</span><span class="token punctuation">,</span><br>                            <span class="token attr-name">type:</span> <span class="token string">"application/pdf"</span><span class="token punctuation">,</span><br>                            <span class="token attr-name">disposition:</span> <span class="token string">"inline"</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>Following the same pattern as the railscast, I created a <a href="https://gist.github.com/bchadfield/5274166" target="_blank">BriefsPdf class</a> that inherited from Prawn::Document. This initializes, taking the arguments, which are my objects, then calls methods that render boxes and text. It’s a bit hacked together, but you get the picture. I kept the <a href="http://chadfield.org/assets/brief.pdf" target="_blank">testing output</a>, so that’s what the class renders.</p>
<p>The biggest “gotcha” I came across was with using bounding boxes and text boxes. The cursor, which moves down the page as it renders, behaves differently with those boxes. I ran into trouble with my two bounding boxes, because if the cursor is moved to the bottom of the right box. If the left box is higher I got overlap. With text boxes the cursor doesn’t move down at all. You have to move it manually with move_down. This is fine if you know the height of the box. With user input you don’t have control. That’s why I’m not using text boxes.</p>
<p>The mailer is the simplest part of the whole process.</p>
<pre class="language-elixir"><code class="language-elixir"><span class="token keyword">def</span> <span class="token function">send_brief</span><span class="token punctuation">(</span>brief<span class="token punctuation">,</span> user<span class="token punctuation">)</span><br>  <span class="token attribute variable">@brief</span> <span class="token operator">=</span> brief<br>  <span class="token attribute variable">@user</span> <span class="token operator">=</span> user<br>  filename <span class="token operator">=</span> <span class="token string">"brief_<span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token attribute variable">@brief</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">parameterize</span><span class="token punctuation">(</span>sep <span class="token operator">=</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token delimiter punctuation">}</span></span>_<span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token module class-name">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">strftime</span><span class="token punctuation">(</span><span class="token string">'%Y%m%d'</span><span class="token punctuation">)</span><span class="token delimiter punctuation">}</span></span>.pdf"</span><br>  attachments<span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token module class-name">BriefPdf</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token attribute variable">@brief</span><span class="token punctuation">,</span> <span class="token attribute variable">@user</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<br>  <span class="token function">mail</span><span class="token punctuation">(</span><span class="token attr-name">to:</span> <span class="token attribute variable">@user</span><span class="token punctuation">.</span>email<span class="token punctuation">,</span><br>       <span class="token attr-name">cc:</span> <span class="token attribute variable">@brief</span><span class="token punctuation">.</span>email<span class="token punctuation">,</span><br>       <span class="token attr-name">subject:</span> <span class="token string">"New brief from <span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token attribute variable">@brief</span><span class="token punctuation">.</span>name<span class="token delimiter punctuation">}</span></span>"</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre>
<p>I’m using a dynamic file name for the PDF, so the client and copywriter have a reference. The actual attachment is a single line.</p>
<p>There you have it. I’ll be using this same technique for creating invoices and subscription agreements.</p>
<p>Here’s the list of resources that guided me:</p>
<ul class="list">
<li><a href="http://railscasts.com/episodes/153-pdfs-with-prawn-revised" target="_blank">Railscast</a></li>
<li><a href="http://prawn.majesticseacreature.com/manual.pdf" target="_blank">Prawn documentation</a></li>
<li><a href="http://guides.rubyonrails.org/action_mailer_basics.html" target="_blank">Action Mailer guide</a></li>
<li><a href="http://stackoverflow.com/a/14429812" target="_blank">This stackoverflow answer</a></li>
</ul>

  </div>
</article>
</main>

    <!-- footer -->
    

<footer class="site-foot" role="contentinfo">
  <div class="wrapper">
    <div class="site-foot__inner">
      <nav id="footernav" class="site-foot__inner" aria-label="Footer">

        &copy; 2024 <a href="/" >Problem First</a>
        
      </nav>

      <nav id="social" class="site-foot__inner" aria-label="Social links">
        

        
        <a href="https://www.linkedin.com/in/benchadfield/" rel="me" target="_blank">
          
          <span class="sr-only">linkedin</span>
          <div aria-hidden="true"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  aria-hidden="true"
  focusable="false"
>
  <path
    d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"
  ></path>
  <rect x="2" y="9" width="4" height="12"></rect>
  <circle cx="4" cy="4" r="2"></circle>
</svg>
</div>
          </a
          >
        

        
        <a href="https://github.com/bchadfield" rel="me" target="_blank">
          
          <span class="sr-only">github</span>
          <div aria-hidden="true"><svg
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  aria-hidden="true"
  focusable="false"
>
  <path
    d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"
  ></path>
  <path d="M9 18c-4.51 2-5-2-7-2"></path>
</svg>
</div>
          </a
          >
        

        
        <a href="https://chadfield.org/feed.xml" rel="alternate" type="application/rss+xml" target="_blank">
        
          <span class="sr-only">rss</span>
          <div aria-hidden="true"><svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  aria-hidden="true"
  focusable="false"
>
  <path d="M4 11a9 9 0 0 1 9 9"></path>
  <path d="M4 4a16 16 0 0 1 16 16"></path>
  <circle cx="5" cy="19" r="1"></circle>
</svg>
</div>
          </a
          >
        


        </nav>
    </div>
  </div>

  <!-- lang menu -->
</footer>




    <script lang="javascript">
      if (localStorage.theme === 'true' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        console.log("dark")
        document.body.classList.add('dark-mode')
      } else {
        console.log("light")
        document.body.classList.remove('dark-mode')
      }
    </script>
  </body>
</html>
